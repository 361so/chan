# 城市微光 (City Glimmer)

**用镜头记录城市温度，让每一份美好被看见。**

“城市微光”是一个基于微信小程序的城市文明共建平台，鼓励市民随手拍下社区美景、文明瞬间与公益行动。用微小的力量汇聚成城市文明的璀璨星河。每一次打卡都是对家园的热爱，每一份分享都能点亮城市的文明之光。

**一句话定位**：市民随手拍文明行为、社区美景，完成公益任务，赚积分领荣誉，城市文明共建平台。

## 🌟 核心功能

### 1. 📍 文明地图 (首页)
- **可视化展示**：在地图上直观展示所有审核通过的文明打卡点。
- **详情弹窗**：点击标记点可查看图片、视频及详细描述。
- **一键导航**：支持调用地图软件导航至打卡地点。

### 2. 📸 文明打卡 (上报)
- **多类型上报**：支持“社区美景”、“文明行为”、“公益行动”三种类型。
- **多媒体支持**：支持上传图片（自动压缩）和视频。
- **智能定位**：自动获取当前位置，支持手动微调选择地点。
- **内容安全**：集成微信云开发内容安全能力，自动检测文本和图片是否违规，保障平台内容健康。

### 3. 🏘️ 文明广场 (发现)
- **动态流**：展示全城最新、最热的文明动态。
- **互动体系**：支持点赞（真实数据统计）、分享给好友或朋友圈。
- **详情浏览**：查看动态详情，包括位置地图、发布时间、审核状态等。

### 4. 👮 管理员审核
- **移动端审核**：管理员可在手机端直接处理待审核记录。
- **审核操作**：
    - **通过**：自动发放对应积分（美景10分/行为15分/公益20分）。
    - **驳回**：必须填写驳回理由，用户可见。
- **数据管理**：支持查看所有历史记录，按时间倒序排列。

### 5. 👤 个人中心
- **积分体系**：实时统计用户积分、累计上报数及本周排名。
- **打卡历史**：查看自己的上报记录状态（审核中/已通过/已驳回），支持删除“待审核”的记录。
- **积分记录**：查看积分获取明细。

## 🛠️ 技术栈

- **前端框架**: [UniApp](https://uniapp.dcloud.io/) + [Vue 3](https://v3.vuejs.org/) (Composition API)
- **构建工具**: [Vite](https://vitejs.dev/)
- **状态管理**: [Pinia](https://pinia.vuejs.org/)
- **后端服务**: **微信小程序云开发 (WeChat Cloud Development)**
    - **云函数**: 处理业务逻辑、权限校验、内容安全检查。
    - **云数据库**: NoSQL 数据库存储用户、上报、点赞数据。
    - **云存储**: 存储上传的图片和视频资源。

## 📂 目录结构

```
cloudfunctions/        # 云函数目录
  ├── api/             # 核心业务接口 (登录、上报、列表、审核等)
  └── checkContent/    # 内容安全检查 (文本/图片)
src/
  ├── api/             # 前端 API 封装
  ├── pages/           # 页面文件
  │   ├── index/       # 首页 (地图模式)
  │   ├── feed/        # 广场 (列表/详情)
  │   ├── report/      # 打卡上报
  │   ├── rank/        # 排行榜
  │   ├── user/        # 个人中心 (历史/积分/设置)
  │   ├── admin/       # 管理员审核
  │   └── login/       # 登录页
  ├── static/          # 静态资源
  ├── store/           # Pinia 状态管理 (user, location)
  ├── utils/           # 工具函数 (request, share, update)
  ├── App.vue          # 根组件 (热更新检测)
  ├── main.js          # 入口文件
  └── manifest.json    # 应用配置
```

## 🚀 快速开始

### 1. 环境准备
- 安装 [HBuilderX](https://www.dcloud.io/hbuilderx.html) 或 VS Code。
- 安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)。
- 注册微信小程序账号，并开通**云开发**环境。

### 2. 获取代码
```bash
git clone https://github.com/your-repo/city-glimmer.git
npm install
```

### 3. 云开发配置 (关键)
1.  **云环境初始化**：
    - 在微信开发者工具中打开项目，点击“云开发”按钮，开通并获取环境 ID。
    - 在 `project.config.json` 中确认 `cloudfunctionRoot` 为 `cloudfunctions/`。

2.  **创建数据库集合**：
    在云开发控制台 -> 数据库中创建以下集合：
    - `users`：用户信息
    - `reports`：上报记录
    - `likes`：点赞记录

3.  **部署云函数**：
    - 在 `cloudfunctions/api` 和 `cloudfunctions/checkContent` 目录上分别右键，选择 **“上传并部署：云端安装依赖”**。
    - **注意**：`api` 函数需配置超时时间（建议 20s），`checkContent` 需配置 `config.json` 权限（openapi）。

4.  **配置 AppID**：
    - 在 `manifest.json` -> 微信小程序配置中，填入你的 AppID。

### 4. 运行项目
- **命令行运行**: `npm run dev:mp-weixin`
- **HBuilderX 运行**: 运行 -> 运行到小程序模拟器 -> 微信开发者工具

## 📝 许可证

MIT
